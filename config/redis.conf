# Redis configuration for KATO pattern metadata storage
# Hybrid RDB + AOF persistence for durability + performance

# RDB Snapshots (point-in-time backups)
# Save after 15 minutes if at least 1 key changed
save 900 1
# Save after 5 minutes if at least 10 keys changed
save 300 10
# Save after 1 minute if at least 10000 keys changed
save 60 10000

# RDB file configuration
dbfilename kato_patterns.rdb
dir /data
rdbcompression yes
rdbchecksum yes

# AOF (Append-Only File) for durability
appendonly yes
appendfilename "kato_patterns.aof"
# Fsync every second (balance durability/performance)
appendfsync everysec

# Hybrid mode: RDB preamble + AOF for fast loading and durability
aof-use-rdb-preamble yes

# AOF rewrite configuration
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb
aof-rewrite-incremental-fsync yes

# Memory management
maxmemory 8gb
# Evict least recently used keys if memory full
maxmemory-policy allkeys-lru

# Optimize for persistence
rdb-save-incremental-fsync yes

# Logging
loglevel notice
logfile ""

# Security
# Disabled for Docker network (kato-network is isolated)
protected-mode no
# Bind to all interfaces (Docker internal network)
bind 0.0.0.0 ::
